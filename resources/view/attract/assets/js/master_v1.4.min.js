
var ExcerptJS = function(params){
	var self = this;
	// settings
	this.len = {
		min: 0,
		max: 0
	};
	this.numberOfWords = 0;
	this.numberOfSentence = 0;
	// source
	this.txt = '';
	// out text
	this.output = '';

	this.init = function(params){
		this.len.min = params.len.min;
		this.len.max = params.len.max;
		this.numberOfWords = params.numberOfWords;
		this.numberOfSentence = params.numberOfSentence;
	}

	this.input = function(txt){
		this.txt = txt;
	}

	this.process_symbols = function(){
		let words = this.txt.split(' ');
		let res = [];
		let totalLength = 0;
		for(let word of words){
			if(totalLength > this.len.max){
				res.pop();
				break;
			}
			if(totalLength > this.len.min){
				break;
			}
			res.push(word);
			totalLength += word.length + 1;
		}
		this.output = res.join(' ');
	}

	this.process_words = function(){
		let words = this.txt.split(' ');
		let res = [];
		let totalLength = 0;
		let item = 1;
		for(let word of words){
			if(totalLength > this.len.max){
				res.pop();
				break;
			}
			if(item > this.numberOfWords){
				break;
			}
			res.push(word);
			totalLength += word.length + 1;
			item++;
		}
		this.output = res.join(' ');
	}

	this.process_sentence = function(){
		let sentences = this.txt.split('.');
		let item = 1;
		let res = [];
		let totalLength = 0;
		for(let sentence of sentences){
			if(totalLength > this.len.max){
				res.pop();
				break;
			}

			if(item > this.numberOfSentence){
				break;
			}

			res.push(sentence);

			totalLength += sentence.length + 1;
			item++;
		}

		this.output = res.join('.') + '.';
		this.output = this.output == '.' ? '' : this.output;
	}

	this.out = function(opt){
		this['process_' + opt]();
		return this.output;
	}

	this.init(params);
}

function dataFuncInit(){
  $('[data-func]').on('click', function(){
	var funcname = $(this).attr('data-func');
	switch(funcname){
	  case 'open-search-func':
		$('button.search-open').trigger('click');
	  break;
	  case 'open-new-profile-form':
		$('button.new-user-open').trigger('click');
	  break;
	  case 'go-to-news':
		document.location = 'http://news.astralmagic.ru';
	  break;
	  default: console.log('undefined data-func');
	}
  });
}

function dataHrefInit(){
  $('[data-href]').click(function(){
	var href = $(this).attr('data-href');
	$(this).attr('href', href);
  });
}

function mainEventsInit(){
  $('.danger-link').click(function(){
	var ans = confirm('Удалить?');
	console.log(ans);
	if(!ans){
	  return false;
	}
  });

  // img-radio btn
  $('.img-radio .radio').on('click', function(){
	$(this).parent().find('.radio').removeClass('active');
	$(this).addClass('active');
	$(this).parent().find('input').val($(this).attr('data-val'));
  });
}

function closePopUpInit(){
  $('.hidden-bg, .close-popup').on('click', function(){
		$('.hidden-bg').hide();
	$('.search-result').hide();
		$('.popup').removeClass('active');
	});
}

function goToReview(){
	var hash = document.location.hash;
	var review = hash.split('#review-');
	if(review.length != 2){
		return false;
	}

	review = review[1];
	var reviewCont = $(hash);
	setTimeout(function(){
		reviewCont.find('.review-foot a', 0).trigger('click');
	}, 500);
}

function excerptNewsItemsOnHomePage(){
  if(document.location.pathname != '/'){
	return false;
  }

  let params = {
	len: {
	  min: 100,
	  max: 110
	},
	numberOfWords: 10,
	numberOfSentence: 1
  }

	let excerpt = new ExcerptJS(params);
	console.log($('.news-item-big .description .news-desc'));
	excerpt.input($('.news-item-big .description .news-desc').html());
	$('.news-item-big .description .news-desc').html(excerpt.out('symbols') + '...');

	let newsItems = $('.news-item');
	for(let i of newsItems){
		let txt = $(i).find('.description .news-desc').html();
		excerpt.input(txt);
		$(i).find('.description .news-desc').html(excerpt.out('symbols') + '...');
	}

	params.len.min = 30;
	params.len.max = 35;
	let excerptNewsTitle = new ExcerptJS(params);
	excerptNewsTitle.input($('.news-item-big a.news-title').html());
	$('.news-item-big a.news-title').html(excerptNewsTitle.out('symbols') + '...')

}

function excerptLastProfiles(){
  if(document.location.pathname != '/'){
	return false;
  }

  let params = {
	len: {
	  min: 250,
	  max: 280
	},
	numberOfWords: 40,
	numberOfSentence: 1
  }

  let excerpt = new ExcerptJS(params);
  let items = $('#last-reviews .review-body');
  for(let i=0; i<items.length; i++){
  	let source = $(items[i]).html();
	excerpt.input(source);
	let result = excerpt.out('symbols');
	if(result != source){
		result += '...';
	}
	$(items[i]).html(result);
  }
}

function loaderShow(selector){
	$(selector).removeClass('hid');
}

function loaderHid(selector){
	$(selector).addClass('hid');
}

function mobileNavInit(){
  // MOBILE MENU
  $('.mobile-menu .menu').html($('nav.main').html());

  $('button[data-menu]').click(function(){
    if($(this).hasClass('menu')){
       $('.mobile-menu').addClass('active');
       $(this).addClass('close');
       $(this).removeClass('menu');
    }else{
       $('.mobile-menu').removeClass('active');
       $(this).removeClass('close');
       $(this).addClass('menu');
    }
  })

  $('.mobile-menu a').on('click', function(){
   $('button[data-menu].close').trigger('click');
  });
}
var FormControl = function(){
  var self = this;
  
  this.newSelect = function(selector){
    self.selectControl(selector);
  }
  
  this.selectControl = function(selector){
  	var sel = $(selector);
  	var icon = sel.find('.m-icon', 0);
  	var inp = sel.find('input',0);
  	var placeholder = sel.find('.placeholder');
  	if(sel.hasClass('select')){
  		var closeLay = sel.find('.close-layer');
  		var optContainer = sel.find('.options');
  		var options = optContainer.find('.option');
  		$(sel).on('click', function(){
  			if(optContainer.hasClass('open')){
  				return false;
  			}
  			optContainer.slideDown('fast');
  			optContainer.addClass('open');
  			closeLay.show();
  		});
  
  		options.on('click', function(){
  			var val = $(this).html();
  			placeholder.html(val);
  			inp.val($(this).attr('data-value'));
  			setTimeout(function(){
  				optContainer.removeClass('open');
  			}, 50);
  			optContainer.slideUp('fast');
  			closeLay.hide();
  		});
  
  		closeLay.on('click', function(){
  			setTimeout(function(){
  				optContainer.removeClass('open');
  			}, 50);
  			optContainer.slideUp('fast');
  			closeLay.hide();
  		});
  
  	}
  }
  
  this.checkboxControl = function(el){
    var val = $(el).parent().find('input[type="hidden"]').val();
    if(val == 0){
      $(el).parent().find('input[type="hidden"]').val('1');
      $(el).parent().find('.box').addClass('active');
    }else{
      $(el).parent().find('input[type="hidden"]').val('0');
      $(el).parent().find('.box').removeClass('active');
    }
  }
  
  this.newCheckbox = function(selector){
    $(selector).on('click', function(){
      self.checkboxControl(this);
    });
  }
  
}
var Search = function(){
	var self = this;
	this.urlTemplate = '/api/search/';
	this.searchInput = '.search-input';
	this.resultContainer = '.search-result';

	this.controller = function(){
		$(self.searchInput).on('keydown', function(){
			self.model(this);
		});

		$('.search-open').on('click', function(){
			self.open();
			$('.search-result').show();
		});
	}

	this.open = function(){
		$('.search').addClass('active');
		$('.hidden-bg').show();
	}

	this.model = function(el){
		word = $(el).val();
		$.getJSON(self.urlTemplate + word, function(d){
			self.draw(d);
		});
	}

	this.draw = function(d){
		$(self.resultContainer).html(d.result);
	}

	self.controller();
}

var Comments = function(){
  var self = this;
  this.countCommentsOnPageNow = 0;
  this.countOnPage = 3;
  this.currentCommentPages = 0;
  
  this.openComments = function(container){
    $(comments).find('.comments-paginator').show();
  	$(comments).find('.block-title').show();
  	$(container).slideDown('normal');
  	var comments = $(container).find('.comment-item');
  	self.countCommentsOnPageNow = self.countOnPage;
  	self.currentCommentPages = 1;
  	self.CPCounterProcessor(container, comments.length);
  
  	$(comments).hide();
  	var min = Math.min(comments.length, self.countOnPage);
  	for(var i=0;i<min;i++){
  		$(comments[i]).show();
  	}

    $(container).find('.new-comment').attr('data-comment-id', '0');
  }
  
  this.initProfileComments = function(){
    $('#profile .review-item .review-foot a').on('click', function(){
  		var count = parseInt($(this).find('span', 0).html().split('(')[1]);
  		var comments = $(this).parent().parent().parent().parent().find('.comments');
  		if(count == 0){
  			$(comments).find('.comment-item').hide();
  			$(comments).find('.comments-paginator').hide();
  			$(comments).find('.block-title').hide();
  			$(comments).slideDown('normal');
  			return false;
  		}
  
  		if(!$(comments).is(':visible')){
  			// open
  			self.openComments(comments);
  		}else{
  			// close
  			$(comments).slideUp('normal');
  		}
  
  		return false;
  	});
  }

  this.initAnswerBtn = function(){
    let self = this;
    $('.comment-item .answer').on('click', function(e){
      e.preventDefault();
      let commentID = $(this).attr('data-comment-id');
      let uname = $(this).attr('data-uname');
      let container = $($(this).parent().parent().parent().parent().parent());
      self.cancelAnswer(container);
      $(this).hide();
      container.find('.new-comment').attr('data-comment-id', commentID);
      container.find('.answer-desc .uname').html(uname);
      container.find('.answer-desc').show();
      container.find('.new-comment input', 0).focus();
    });

    $('.answer-cancel').on('click', function(){
      let container = $(this).parent().parent().parent();
      self.cancelAnswer(container);
    });
  }

  this.cancelAnswer = function(container){
    $(container).find('.new-comment').attr('data-comment-id', '0');
    $(container).find('.answer-desc').hide();
    $(container).find('.comment-item .answer').show();
  }
  
  this.commentsPaginationInit = function(){
    $('.next-comments-page').on('click', function(){
  		self.commentsPagination($(this).parent().parent(), 'next');
  	});
  	$('.prev-comments-page').on('click', function(){
  		self.commentsPagination($(this).parent().parent(), 'prev');
  	});
  }
  
  this.closeProfileCommentsInit = function(){
    $('.close-comments').click(function(){
  		var comments = $(this).parent();
  		if(!$(comments).is(':visible')){
  			// open
  			this.openComments(comments);
  		}else{
  			// close
  			$(comments).slideUp('normal');
  		}
  	});
  }
  
  this.commentsPagination = function(container, way){
    var comments = $(container).find('.comment-item');
  	var total = comments.length;
  	if(way == 'next')
  		self.currentCommentPages++;
  	else{
  		self.currentCommentPages--;
  	}
  	self.countCommentsOnPageNow = self.countOnPage * self.currentCommentPages;
  	if(Math.abs(total - self.countCommentsOnPageNow) < self.countOnPage){
  		// next
  		self.CPCounterProcessor(container, total);
  	}else{
  		// first
  		self.countCommentsOnPageNow = 3;
  		self.currentCommentPages = 1;
  		self.CPCounterProcessor(container, total);
    }
    
    $(comments).hide();
  	var min = Math.min(self.countCommentsOnPageNow, total);
  	var start = self.countCommentsOnPageNow - self.countOnPage;
  
  	for(var i=start;i<min;i++){
  		$(comments[i]).show();
  	}
  }
  
  this.CPCounterProcessor = function(container, total){
  	var cp_counter = $(container).find('.cp-counter');
  	var m = Math.min(self.countCommentsOnPageNow, total);
  	cp_counter.html(m + ' из ' + total);
  	if(total <= self.countOnPage){
  		$(cp_counter).parent().find('button').hide();
  	}else{
  		$(cp_counter).parent().find('button').show();
  	}
  }
  
  this.sendNewCommentInit = function(){
  	$('.new-comment .send-btn').on('click', function(){
  		var btn = $(this);
  		var form = btn.parent();
      let commentID = btn.parent().attr('data-comment-id');
  		if(btn.hasClass('disable')){
  			return false;
  		}
  
  		var data = takeData(form);
  		data['create-comment'] = 1;      
      if(typeof commentID == 'undefined'){
        data['reviewid'] = form.attr('data-review-id');
      }else{
  		  data['commentid'] = commentID;
      }
  
  		// clean fields;
  		var inps = form.find('[placeholder]').val('');
  
  		// send data to server
  		var path = '/api/create-comment';
  		$.post(path, data, function(){
  			// success
  			// need view message and reload page
  			form.hide();
  			form.parent().find('.notification').slideDown('fast');
  			setTimeout(function(){
  				document.location = document.location;
  			}, 4000);
  		});
  	});
  }
  
  this.reviewNewCommentValidate = function(){
  	$('.new-comment input, .new-comment textarea').on('change', function(){
  		var form = $(this).parent().parent();
  		var sendbtn = $(this).parent().parent().find('button');
  		var inps = form.find('[placeholder]');
  		var currentEl = $(this);
  		currentEl.attr('current', 'true');
  		for(var i=0;i<inps.length;i++){
  			var inp = $(inps[i]);
  			var inpContain = inp.parent();
  			var val = inp.val();
  			if(val.length < 2){
  				if(inp.attr('current') == 'true'){
  					inpContain.addClass('danger');
  					inp.removeAttr('current');
  				}
  				if(!sendbtn.hasClass('disable')){
  					sendbtn.addClass('disable');
  				}
  			}else{
  				if(inp.attr('current') == 'true'){
  					inpContain.removeClass('danger');
  					inp.removeAttr('current');
  				}
  				if(sendbtn.hasClass('disable')){
  					sendbtn.removeClass('disable');
  				}
  			}
  		}
  	});
  }
  
  this.init = function(){
    self.sendNewCommentInit();
    self.initProfileComments();
    self.commentsPaginationInit();
    self.closeProfileCommentsInit();
    self.reviewNewCommentValidate();
    self.initAnswerBtn();
  }
  
  self.init();
  
}
function check_site_on_exists(){
	$('[name="site"]').on('change', function(){
		var val = $(this).val();
		if(val == ''){
			return false;
		}
		var self = this;
		$.getJSON('/api/exist?site='+val, function(d){
			if(d.result == true){
				$(self).parent().css('border-color', 'red');
				$(self).attr('data-err', true);
				$(self).parent().append('<br><span class="err-mess" style="font-size: 3.5rem; color: red; position: relative; top: -3px;">Такой адрес уже зарегистрирован в системе</span>');
			}else{
				$(self).removeAttr('data-err');
				$(self).parent().removeAttr('style');
				$(self).parent().find('.err-mess').remove();
			}
		});
	});
}
var Rating = function(){
	var self = this;
	this.currentCountRatingList = 0;
  this.ratingListCounter = 1;

  this.get = function(tag){
    self.controller(tag);
  }

	this.controller = function(tag){
    tag = (typeof tag == 'undefined') ? 'order' : tag;
		console.log(tag);
    var limit = self.currentCountRatingList;
    var order = $('input[name="order"]').val();
    if(tag != 'order'){
    // if(order == '' || typeof order == 'undefined'){
      var url = '/api/tag/' + tag + '/limit/' + limit;
    }else{
      var url = '/api/rating/order/' + order + '/limit/' + limit;
    }
		console.log(url);
    $('#rating .preloader').show();
    self.model(url, function(){
      self.loadRatingThumbnails();
    });
	}

	this.model = function(url, callback){
    $.getJSON(url, function(d){
  		$('#rating .preloader').hide();
  		self.currentCountRatingList += d.rating.length;
  		if(self.currentCountRatingList == d.len){
  			$('.load-more').hide();
  		}else{
  			$('.load-more').show();
  		}
  		self.render(d.rating);
      callback();
  	});
	}

	this.render = function(data){
    console.log(data);
    var html = '';
    for(var i in data){
      if(typeof data[i]['id'] == 'undefined'){
        $('.load-more').hide();
        continue;
      }
      var count_review = parseInt(data[i].count_like) + parseInt(data[i].count_dislike) + parseInt(data[i].count_neutral);

      var num = self.ratingListCounter++;
      num = num < 10 ? '0' + num : num;

      if(data[i]['site_obj'] == false){
        data[i]['site_obj'] = {'screen': '/resources/assets/imgs/screens/default-screen.jpg'};
        data[i]['site_obj']['description'] = 'Игорь Леонидович Николаев – потомственный сибирский маг в пятом колене. Работает официально с 1989 года. Зарекомендовал себя как самый сильный и известный колдун не только в Красноярске, но и по всей Сибири. Верховный жрец ковена Волка-Орла. Магистр черной и белой магии.';
      }

      let description_tmp = data[i]['site_obj']['description'].split('.');
      let description = description_tmp[0] + '.' + description_tmp[1];
      if(description.split(' ').length < 30){
        description += description_tmp[2] + '...';
      }else{
        description += '...';
      }

      if(typeof data[i].cat.title == 'undefined'){
        data[i].cat = {'title': 'Без категории'}
      }

      html += '<div class="rating-item">' +
        '<div class="row">' +
          '<div class="col-3 d-none d-xl-block">' +
            '<div class="cover-container">' +
              '<img src="" data-site-thumbnail="/get-site-thumbnail/' + data[i]['site_obj']['id'] + '" class="cover">' +
              // '<img src="' + data[i]['site_obj']['screen'] + '" class="cover">' +
            '</div>' +
          '</div>' +
          '<div class="col-xl-9 col-12 rating-item-content">' +
            '<div class="row">' +
              '<div class="col-12 col-lg-8 col-xl-8">' +
                '<div class="top Profile-info">' +
									'<div class="number txt-grey-dark"><span>' + data[i]['number_txt'] + '</span></div>' +
                  '<a href="' + data[i]['to_profile'] + '" class="std-a Profile-name">' + data[i].name + '</a><span class="txt-grey Profile-site"> - ' + data[i].site + '</span>' +
                '</div>' +
                '<div class="bottom location txt-grey">' +
                  'Общий рейтинг: <strong class="txt-grey-dark">' + data[i].rating + '</strong>' +
                  //'Страна <span class="txt-grey-dark">Украина</span>, город <span class="txt-grey-dark">Киев</span>' +
                '</div>' +
                '<div class="bottom categoty txt-grey">' +
                  'Категория: <span class="txt-grey-dark">' + data[i].cat.title + '</span>' +
                '</div>' +
              '</div>' +

              '<div class="col-12 col-lg-4 col-xl-4">' +
                '<div class="top stats txt-grey-dark">' +
                  '<i class="mdi mdi-thumb-up font-color-green"></i>&nbsp;&nbsp;' + data[i].count_like +
                  '&nbsp;&nbsp;<i class="mdi mdi-thumb-down font-color-red"></i>&nbsp;&nbsp;' + data[i].count_dislike +
                  '&nbsp;&nbsp;<i class="mdi mdi-thumbs-up-down font-color-grey"></i>&nbsp;&nbsp;' + data[i].count_neutral +
                '</div>' +
                '<div class="bottom timestamp txt-grey">' +
                  'Добавлен ' + data[i].timestamp +
                '</div>' +
              '</div>' +
            '</div>' +
            '<div class="row">' +
              '<div class="col-12 txt-grey bottom">' +
                description +
              '</div>' +
            '</div>' +
          '</div>' +
        '</div>' +
      '</div>';
    }

    $('#rating .items-container').append(html);
	}

	this.loadRatingThumbnails = function(){
		var thumb = $('[data-site-thumbnail]:eq(0)');
		if(thumb.length == 0) return false;
		$.get($(thumb).attr('data-site-thumbnail'), function(res){
			if(res == ''){
				res = '/resources/view/attract/assets/imgs/screens/default-screen.jpg';
			}
			$(thumb).attr('src', res);
			$(thumb).removeAttr('data-site-thumbnail');
			self.loadRatingThumbnails();
		});
	}

}

$(document).ready(function(){
	$('.carousel').carousel({
		interval: 5000
	});

	mobileNavInit();

	// profile_comments
	let comments = new Comments();

	// $('.carousel').carousel('2');
	var formControl = new FormControl();
	formControl.newSelect('#rating-order');
	formControl.newSelect('.new-user .select');
	formControl.newCheckbox('.checkbox .box');
	formControl.newCheckbox('.checkbox .label');
	formControl.newCheckbox('.checkbox .placeholder');

	$('.new-user-open').on('click', function(){
		$('.new-user').addClass('active');
		$('.hidden-bg').show();
	});

	$('.new-review .input.image input[type="file"]').on('change', function(){
		inpFileToBase64();
	});

	let search = new Search();
	$('#rating .load-more').on('click', function(){
		var tag = $(this).attr('data-tag');
		if(typeof tag != 'undefined' && tag != ''){
			rating.get(tag);
		}else{
			rating.get();
		}
	});

	$('[data-emulate-a]').on('click', function(){
		document.location = $(this).attr('data-emulate-a');
	});

// excerpt news description

	excerptNewsItemsOnHomePage();
	excerptLastProfiles();


	mainEventsInit();
	closePopUpInit();
	dataFuncInit();
	dataHrefInit();

	goToReview();

	addNewProfile();
	addNewReview();
	check_site_on_exists();
	disable_submit_btn();
});

var INPUT_image = false;
var INPUT_image_SIZE = 0;

var takeData = function(container){
	var container = $(container);
	var inp = $(container).find('input');
	var textarea = $(container).find('textarea');
	var data = {};
	for(var i = 0; i < inp.length; i++){
		data[$(inp[i]).attr('name')] = $(inp[i]).val();
		if($(inp[i]).attr('data-err')){
			data[$(inp[i]).attr('name')] = '';
		}
	}
	if(textarea.length > 0){
		for(var i = 0; i < textarea.length; i++){
			data[$(textarea[i]).attr('name')] = $(textarea[i]).val();
		}
	}
	return data;
}


var addNewProfile = function(){
	$('.new-user .send-btn').on('click', function(){
		if($(this).hasClass('disable'))
			return false;
		var container = '.new-user';
		var data = takeData(container);
		data['create-profile'] = true;
		if(data['agree'] != '1'){
			return false;
		}

		loaderShow('#create-profile-loader');

		$('.new-user .send-btn').addClass('disable').attr('disable');

		$.post('/api/create-profile', data, function(response){
			$(container).find('[name="site"]').val('');
			$(container).find('[name="name"]').val('');
			$(container).find('.agree-box').trigger('click');
			$(container).find('.new-user-form').fadeOut('fast', function(){
				$(container).find('.notification').fadeIn('fast');
			});
			loaderHid('#create-profile-loader');
			setTimeout(function(){
				$('.hidden-bg').trigger('click');
				setTimeout(function(){
					$(container).find('.new-user-form').show();
					$(container).find('.notification').hide();
				}, 600);
			}, 4000);
		})
	});

}

function disable_submit_btn(){
	setInterval(function(){
		var data = takeData('.new-user');
		// console.log(data);
		if(data['agree'] == '1' && data['site'].length > 0 && data['name'].length > 0 && data['catid'] != 0){
			$('.new-user .send-btn').removeClass('disable').removeAttr('disable');
		}else{
			if(!$('.new-user .send-btn').hasClass('disable')){
				$('.new-user .send-btn').addClass('disable').attr('disable', 'disable');
			}
		}

		data = takeData('.new-review');
		if(typeof data['username'] != 'undefined'){
			// console.log(data);
			if(data['username'].length > 0 && data['email'].length > 0 && data['message'].length > 0 && data['rating'] != '-2'){
				$('.new-review .send-btn').removeClass('disable').removeAttr('disable');;
			}else{
				if(!$('.new-review .send-btn').hasClass('disable')){
					$('.new-review .send-btn').addClass('disable').attr('disable', 'disable');
				}
			}
		}

	}, 300);
}

var inpFileToBase64 = function(){
	var file    = document.querySelector('.input.image input').files[0];
	document.querySelector('.input.image .placeholder').innerHTML = file.name;
	INPUT_image_SIZE = file.size;
	var reader  = new FileReader();

	reader.onloadend = function () {
		INPUT_image = reader.result;
	}

	if (file) {
		reader.readAsDataURL(file);
	} else {

	}

}

var addNewReview = function(){
	$('.new-review .send-btn').on('click', function(){
		var container = '.new-review';
		var data = takeData(container);
		data['create-review'] = true;
		if(INPUT_image){
			data['image'] = INPUT_image;
		}

		if(INPUT_image_SIZE / 1024 / 1024 > 2){
			// showNotif('Изображение не должно быть больше 2х мегабайт!', 4000, '#E53935', '#B71C1C');
			return false;
		}

		$('.new-review .send-btn').addClass('disable').attr('disable', 'disable');

		$.post('/api/create-review', data, function(response){
			// console.log(response);
			$(container).find('[name="username"]').val('');
			$(container).find('[name="email"]').val('');
			$(container).find('[name="message"]').val('');
			$(container).find('[name="photo"]').val('');
			$(container).find('[name="rating"]').val('0');
			$(container).find('[name="rating"]').parent().find('.radio').removeClass('active');
			$(container).find('.input.image .placeholder').html($(container).find('.input.image .placeholder').attr('data-default'));
			INPUT_image = false;
			INPUT_image_SIZE = 0;
			$(container).find('.add-review-form').fadeOut('fast', function(){
				$(container).find('.notification').fadeIn('fast');
			});
			setTimeout(function(){
				$(container).find('.notification').fadeOut('fast', function(){
					$(container).find('.add-review-form').fadeIn('fast');
				});
			}, 4000);
		})
	});

}